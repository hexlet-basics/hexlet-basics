# typed: true

# DO NOT EDIT MANUALLY
# This is an autogenerated file for types exported from the `async-service` gem.
# Please instead update this file by running `bin/tapioca gem async-service`.


# source://async-service//lib/async/service/managed/environment.rb#6
module Async; end

# source://async-service//lib/async/service/managed/environment.rb#7
module Async::Service; end

# Represents a service configuration with lazy evaluation and module composition.
#
# Environments store configuration as methods that can be overridden and composed using Ruby modules. They support lazy evaluation through evaluators.
#
# source://async-service//lib/async/service/environment.rb#11
class Async::Service::Environment
  # Initialize a new environment.
  #
  # @return [Environment] a new instance of Environment
  #
  # source://async-service//lib/async/service/environment.rb#99
  def initialize(facet = T.unsafe(nil), parent = T.unsafe(nil)); end

  # Create an evaluator for this environment.
  #
  # source://async-service//lib/async/service/environment.rb#218
  def evaluator; end

  # Returns the value of attribute facet.
  #
  # source://async-service//lib/async/service/environment.rb#109
  def facet; end

  # Check if this environment implements a given interface.
  #
  # @return [Boolean]
  #
  # source://async-service//lib/async/service/environment.rb#131
  def implements?(interface); end

  # Include this environment's facet into a target module.
  #
  # source://async-service//lib/async/service/environment.rb#116
  def included(target); end

  # Returns the value of attribute parent.
  #
  # source://async-service//lib/async/service/environment.rb#112
  def parent; end

  # Convert the environment to a hash.
  #
  # source://async-service//lib/async/service/environment.rb#224
  def to_h; end

  # Create a new environment with additional configuration.
  #
  # source://async-service//lib/async/service/environment.rb#124
  def with(*_arg0, **_arg1, &_arg2); end

  class << self
    # Build a new environment using the builder DSL.
    #
    # source://async-service//lib/async/service/environment.rb#92
    def build(*_arg0, **_arg1, &_arg2); end
  end
end

# A builder for constructing environments using a DSL.
#
# source://async-service//lib/async/service/environment.rb#13
class Async::Service::Environment::Builder < ::BasicObject
  # Initialize a new builder.
  #
  # @return [Builder] a new instance of Builder
  #
  # source://async-service//lib/async/service/environment.rb#60
  def initialize(facet = T.unsafe(nil)); end

  # Include a module or other includable object into the environment.
  #
  # source://async-service//lib/async/service/environment.rb#66
  def include(target); end

  # Define methods dynamically on the environment.
  #
  # source://async-service//lib/async/service/environment.rb#80
  def method_missing(name, argument = T.unsafe(nil), &block); end

  class << self
    # Create a new environment with facets and values.
    #
    # source://async-service//lib/async/service/environment.rb#19
    def for(*facets, **values, &block); end
  end
end

# An evaluator is lazy read-only view of an environment. It memoizes all method calls.
#
# source://async-service//lib/async/service/environment.rb#136
class Async::Service::Environment::Evaluator
  # Initialize a new evaluator.
  #
  # @return [Evaluator] a new instance of Evaluator
  #
  # source://async-service//lib/async/service/environment.rb#171
  def initialize; end

  # Get value for a given key.
  #
  # source://async-service//lib/async/service/environment.rb#202
  def [](key); end

  # Inspect representation of the evaluator.
  #
  # source://async-service//lib/async/service/environment.rb#177
  def inspect; end

  # Check if a key is available.
  #
  # @return [Boolean]
  #
  # source://async-service//lib/async/service/environment.rb#211
  def key?(key); end

  # Convert the evaluator to a hash.
  #
  # source://async-service//lib/async/service/environment.rb#183
  def to_h; end

  # Convert the evaluator to JSON.
  #
  # source://async-service//lib/async/service/environment.rb#195
  def to_json(*_arg0, **_arg1, &_arg2); end

  class << self
    # Create an evaluator wrapper for an environment.
    #
    # source://async-service//lib/async/service/environment.rb#140
    def wrap(environment); end
  end
end

# Captures the stateful behaviour of a specific service.
# Specifies the interfaces required by derived classes.
#
# Designed to be invoked within an {Async::Controller::Container}.
#
# source://async-service//lib/async/service/generic.rb#12
class Async::Service::Generic
  # Initialize the service from the given environment.
  #
  # @return [Generic] a new instance of Generic
  #
  # source://async-service//lib/async/service/generic.rb#28
  def initialize(environment, evaluator = T.unsafe(nil)); end

  # Returns the value of attribute environment.
  #
  # source://async-service//lib/async/service/generic.rb#34
  def environment; end

  # The name of the service - used for informational purposes like logging.
  # e.g. `myapp.com`.
  #
  # source://async-service//lib/async/service/generic.rb#44
  def name; end

  # Setup the service into the specified container.
  #
  # source://async-service//lib/async/service/generic.rb#55
  def setup(container); end

  # Start the service. Called before the container setup.
  #
  # source://async-service//lib/async/service/generic.rb#49
  def start; end

  # Stop the service. Called after the container is stopped.
  #
  # source://async-service//lib/async/service/generic.rb#60
  def stop(graceful = T.unsafe(nil)); end

  # Convert the service evaluator to a hash.
  #
  # source://async-service//lib/async/service/generic.rb#38
  def to_h; end

  class << self
    # Convert the given environment into a service if possible.
    #
    # source://async-service//lib/async/service/generic.rb#16
    def wrap(environment); end
  end
end

# source://async-service//lib/async/service/managed/environment.rb#8
module Async::Service::Managed; end

# Default configuration for managed services.
#
# This is provided not because it is required, but to offer a sensible default for production services, and to expose a consistent interface for service configuration.
#
# source://async-service//lib/async/service/managed/environment.rb#12
module Async::Service::Managed::Environment
  # Options to use when creating the container, including `restart`, `count`, and `health_check_timeout`.
  #
  # source://async-service//lib/async/service/managed/environment.rb#37
  def container_options; end

  # Number of instances to start. By default, when `nil`, uses `Etc.nprocessors`.
  #
  # source://async-service//lib/async/service/managed/environment.rb#16
  def count; end

  # The timeout duration for the health check. Set to `nil` to disable the health check.
  #
  # source://async-service//lib/async/service/managed/environment.rb#30
  def health_check_timeout; end

  # Any scripts to preload before starting the service.
  #
  # source://async-service//lib/async/service/managed/environment.rb#49
  def preload; end

  # Prepare the instance for running the service.
  #
  # This is called before {Async::Service::Managed::Service#run}.
  #
  # source://async-service//lib/async/service/managed/environment.rb#65
  def prepare!(instance); end

  # The timeout duration for the startup. Set to `nil` to disable the startup timeout.
  #
  # source://async-service//lib/async/service/managed/environment.rb#23
  def startup_timeout; end

  # General tags for metrics, traces and logging.
  #
  # source://async-service//lib/async/service/managed/environment.rb#56
  def tags; end
end

# A health checker for managed services.
#
# source://async-service//lib/async/service/managed/health_checker.rb#10
module Async::Service::Managed::HealthChecker
  # Start the health checker.
  #
  # If a timeout is specified, a transient child task will be scheduled, which will yield the instance if a block is given, then mark the instance as ready, and finally sleep for half the health check duration (so that we guarantee that the health check runs in time).
  #
  # If a timeout is not specified, the health checker will yield the instance immediately and then mark the instance as ready.
  #
  # source://async-service//lib/async/service/managed/health_checker.rb#21
  def health_checker(instance, timeout = T.unsafe(nil), parent: T.unsafe(nil), &block); end
end

# A managed service with built-in health checking, restart policies, and process title formatting.
#
# This is the recommended base class for most services that need robust lifecycle management.
#
# source://async-service//lib/async/service/managed/service.rb#16
class Async::Service::Managed::Service < ::Async::Service::Generic
  include ::Async::Service::Managed::HealthChecker

  # Called after the service has been prepared but before it starts running.
  #
  # Override this method to emit metrics, logs, or perform other actions when the service preparation is complete.
  #
  # source://async-service//lib/async/service/managed/service.rb#65
  def emit_prepared(instance, clock); end

  # Called after the service has started running.
  #
  # Override this method to emit metrics, logs, or perform other actions when the service begins running.
  #
  # source://async-service//lib/async/service/managed/service.rb#76
  def emit_running(instance, clock); end

  # Preload any resources specified by the environment.
  #
  # source://async-service//lib/async/service/managed/service.rb#37
  def preload!; end

  # Run the service logic.
  #
  # Override this method to implement your service. Return an object that represents the running service (e.g., a server, task, or worker pool) for health checking.
  #
  # source://async-service//lib/async/service/managed/service.rb#30
  def run(instance, evaluator); end

  # Set up the container with health checking and process title formatting.
  #
  # source://async-service//lib/async/service/managed/service.rb#83
  def setup(container); end

  # Start the service, including preloading resources.
  #
  # source://async-service//lib/async/service/managed/service.rb#53
  def start; end

  private

  # source://async-service//lib/async/service/managed/service.rb#19
  def format_title(evaluator, server); end
end
